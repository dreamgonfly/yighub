{% extends "yighub/extends/base.html" %}

{% block style %}
.comments p {
	line-height: 180%;
}
{% endblock %}


{% block contents %}

<div class="text-center" style="margin:25px auto 0px auto">
	<h2>{{ album.name }}</h2>
</div>
<div class="row-fluid">
	<div class="container-fluid">
		<span>
			<a href="{% url 'yighub:albums' 0 %}">
				<button type="button" class="btn">앨범 목록</button>
			</a>
		</span>
		<span class="pull-right">
			<a href="{% url 'yighub:create_photos' album.id %}">
				<button type="button" class="btn btn-primary">사진 올리기</button>
			</a>
		</span>
	</div> 
</div>

{% if photos %}

<div class="row-fluid">
	<div class="span2"></div>
	<div class="span8" style="margin-left:auto; margin-right:auto;">

		{% for p in photos %}
		<hr />
		<div class="text-center">
			<img src="{{ p.photo.url }}" style="max-height:600px;" />
		</div>

		<div class="container-fluid" style="max-width: 680px; margin-left: auto; margin-right: auto;">
			<br />
			{% if p.description %}
			{{ p.description|linebreaks }}

			<hr />
			{% endif %}

			<span>
				{% if user not in p.recommendation.all %}
				<a href = "{% url 'yighub:recommend_photo' album.id p.id %}">추천하기</a>
				{% else %}
				<a href = "{% url 'yighub:delete_recommend_photo' album.id p.id %}">추천 취소</a>
				{% endif %}
			</span>
			{% if p.photographer == user %}
			<span class="pull-right">
				<!-- <a href = "{% url 'yighub:edit_photo' album.id p.id %}">수정하기</a>  -->
				&nbsp;&nbsp;
				<script>
				function check_delete_photo_{{p.id}}() {
					if (confirm("정말 삭제하시겠습니까?")){
					window.open("{% url 'yighub:delete_photo' album.id p.id %}", "_self")
					}
				}
				</script>
				<a onclick="check_delete_photo_{{p.id}}()">삭제하기</a>
			</span>
			{% else %}
			<span class="pull-right muted">
				Photo by <strong>{{ p.photographer }}</strong>
			</span>
			{% endif %}

			{% if p.recommendation.all %}
			<br />
			<span class="muted">{{ p.count_recommendation }}명이 추천합니다 -</span>
			{% for r in p.recommendation.all %}
			<strong>
				{% if forloop.counter > 1 %}
				,
				{% endif %}
				&nbsp;{{ r }}
			</strong> 
			{% endfor %}
			{% endif %}

			{% if p.comments.all %}
			<br />
			<br />
			<div class="comments" style="background-color: #edeff4; ">
				{% for c in p.comments.all %}
				<div style="padding: 15px 20px 5px 20px; border-bottom-style: solid; border-width: 2px; border-color: white;">

					<strong>{{ c.creator }}</strong>
					<small class="muted"> {{ c.time_created }} </small>	
					{% if c.creator == user %}
					<span class="pull-right">
						<script>
						function check_delete_comment_photo_{{c.id}}() {
							if (confirm("정말 삭제하시겠습니까?")){
							window.open("{% url 'yighub:delete_comment_photo' album.id p.id c.id %}", "_self")						
							}
						}
						</script>
						<a onclick="check_delete_comment_photo_{{c.id}}()"> 
							<i class="icon-remove" style="opacity:0.25"></i> 
						</a>
					</span>
					{% endif %}
					{{ c.content|linebreaks }}
				</div>
				{% endfor %}

			</div>	
			{% endif %}
			<div style="padding: 15px 20px 5px 20px;">
				<form action = "{% url 'yighub:comment_photo' album.id p.id %}" method = 'post' >
					{% csrf_token %}
					<textarea rows="3" class="span12" name = "content"></textarea>
					<button style="margin: 10px;" class="btn btn-success pull-right" type = "submit">댓글달기</button>
				</form>
			</div>
		</div>

		{% endfor %}

	</div>
	<div class="span2"></div>
</div>
<div class="row-fluid">
	<div class="container-fluid">
		<span>
			<a href="{% url 'yighub:albums' 0 %}">
				<button type="button" class="btn">앨범 목록</button>
			</a>
		</span>
		<span class="pull-right">
			<a href="{% url 'yighub:create_photos' album.id %}">
				<button type="button" class="btn btn-primary">사진 올리기</button>
			</a>
		</span>
	</div> 
</div>

{% else %}
<div class="row-fluid">
	<div class="container-fluid">
		<br />
		<p class="text-center">
			아직 사진이 없습니다. 사진을 올려주세요.
		</p>
	</div> 
</div>
{% endif %}


{% endblock %}